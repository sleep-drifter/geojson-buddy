var iconProps;mapboxgl.accessToken="pk.eyJ1Ijoic2Nvb3R0ZWNoIiwiYSI6IlBMTjNqVTgifQ.r8a_cZRmGF_GIOKIKaK1dA";var satelliteStyle="mapbox://styles/mapbox/satellite-v9",satelliteStreetStyle="mapbox://styles/mapbox/satellite-streets-v9",streetStyle="mapbox://styles/mapbox/streets-v9",darkStyle="mapbox://styles/scoottech/cjvjtjxxu1kj41cqkzf5g6ppn",lightStyle="mapbox://styles/scoottech/cjvjsnesw1jrd1co7dcrtakw1",copyArea=$(".copier textarea"),logger=$("#log"),map=new mapboxgl.Map({container:"map",style:lightStyle,center:[-122.42271869842615,37.77645740426891],zoom:11,bearing:0}),geocoder=new MapboxGeocoder({accessToken:"pk.eyJ1Ijoic2Nvb3R0ZWNoIiwiYSI6IlBMTjNqVTgifQ.r8a_cZRmGF_GIOKIKaK1dA",trackProximity:!0,flyTo:{speed:5},placeholder:"Search for a place or address"});map.addControl(geocoder,"top-left");var draw=new MapboxDraw({displayControlsDefault:!1,controls:{},userProperties:!0,styles:[{id:"gl-draw-line",type:"line",filter:["all",["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#1f80ff","line-dasharray":[.2,2],"line-width":{stops:[[12,2],[16,4]]}}},{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"],["!has","user_featureType"],["!=","active","true"]],paint:{"fill-color":"#000","fill-outline-color":"#41D98D","fill-opacity":.25}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","$type","Polygon"],["==","active","true"]],paint:{"fill-color":"#fc0","fill-outline-color":"#41D98D","fill-opacity":.3}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#333","line-width":1}},{id:"gl-draw-polygon-and-line-vertex-halo-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","active","true"]],paint:{"circle-radius":7,"circle-color":"#FFF"}},{id:"gl-draw-polygon-and-line-vertex-halo-active-2",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["==","active","true"]],paint:{"circle-radius":9,"circle-color":"#FFF"}},{id:"gl-draw-polygon-and-line-vertex-active",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#333"}},{id:"gl-draw-polygon-and-line-midpoint",type:"circle",filter:["all",["!=","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#333"}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","$type","LineString"],["==","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#41D98D","line-width":3}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","$type","Polygon"],["==","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#1E9359","line-width":3}},{id:"highlight-active-points",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":7,"circle-color":"#ffffff"}},{id:"highlight-active-points-stroke",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#000000"}},{id:"points-are-blue-2",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"points-are-blue",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"],["==","active","false"]],paint:{"circle-radius":3,"circle-color":"#000000"}}]});map.addControl(draw);var selectSidebarLayer=function(e){if("none"!==e){$(".layers-container").find("article.layer-item").removeClass("active");for(var t=e.length-1;t>=0;t--){$(".layers-container").find("article[name='"+e[t]+"']").addClass("active")}}else $(".layers-container").find("article.layer-item").removeClass("active")},deleteBtn=$('.action-btn-list li[action="delete"]'),combineBtn=$('.action-btn-list li[action="combine"]'),holeBtn=$('.action-btn-list li[action="hole"]'),expandBtn=$('.action-btn-list li[action="expand"]'),snapBtn=$('.action-btn-list li[action="snap"]'),cutBtn=$('.action-btn-list li[action="cut"]'),dupBtn=$('.action-btn-list li[action="duplicate"]'),toggleControls=function(e){1===e.length?(deleteBtn.addClass("disabled"),combineBtn.addClass("disabled"),holeBtn.addClass("disabled"),expandBtn.addClass("disabled"),cutBtn.addClass("disabled"),dupBtn.addClass("disabled")):2===e.length?(deleteBtn.removeClass("disabled"),combineBtn.addClass("disabled"),holeBtn.addClass("disabled"),expandBtn.removeClass("disabled"),cutBtn.addClass("disabled"),dupBtn.removeClass("disabled")):(deleteBtn.removeClass("disabled"),combineBtn.removeClass("disabled"),holeBtn.removeClass("disabled"),expandBtn.addClass("disabled"),cutBtn.removeClass("disabled"),dupBtn.addClass("disabled"))},updateFeatureTypeIndicator=function(e){if("na"!==e){var t=draw.getSelected().features[0].properties.featureType;console.log(t),$(".current-feature-item select").val(t)}else $(".current-feature-item select").val("na")};$(".current-feature-item select").change((function(){var e=$(this).val(),t=draw.getSelected().features[0];console.log(t),t.properties.featureType=e;var a=turf.featureCollection([t]),r=draw.getSelected().features[0].id;console.log(e),draw.delete(r),draw.add(a)}));var removeLayerFromList=function(e,t){var a;a=t?e:e.id;var r=$("#map-layers").find(".list-item[layerId="+a+"]");console.log(r),console.log("here"),r.remove()},updateLayerList=function(){for(var e=draw.getAll(),t=0;t<e.features.length;t++){var a=e.features[t],r=(a.geometry.type,a.id),o=(a.properties.name,$("#map-layers").find(".list-item[layerId="+r+"]"));console.log(o),o.length>0?console.log("exists"):console.log("does not exist")}},addLayerToList=function(e,t,a){console.log(e),void 0===t?(t=e.id,console.log("undefined")):(t=t[0],e=e.features[0],console.log("else")),console.log(e);var r,o=e.geometry.type;if(void 0!==a){console.log(a);var n=$("#map-layers").find(".list-item[layerid="+a+"] p");console.log(n),r=n.text(),console.log(t,a,r)}else r="Untitled",console.log("false");void 0!==e.properties.layerName&&(r=e.properties.layerName);var l='<div class="list-item icon-w-actions" '+o+' type="'+o+'" layerId="'+t+'"> <i class="fa fa-map-marker-alt"></i> <i class="fa fa-minus"></i> <i class="fa fa-draw-polygon"></i> <p>'+r+'</p> <ul> <li><i class="fa fa-pencil-alt"></i></li> <li><i class="fa fa-search-plus"></i></li><li><i class="fa fa-trash"></i></li> </ul> </div>';$("#map-layers").append(l)},updateGeo=function(){console.log("CHECK GEO"),1===draw.getSelectedPoints().features.length?snapBtn.removeClass("disabled"):snapBtn.addClass("disabled");var e=draw.getSelected();if(0===e.features.length)return $("#map-layers").find(".list-item").removeClass("active"),selectSidebarLayer("none"),toggleControls(["new"]),void updateFeatureTypeIndicator("na");if(1===e.features.length?(toggleControls(["new","delete"]),updateFeatureTypeIndicator()):(toggleControls(["new","delete","all"]),updateFeatureTypeIndicator("na")),e.features.length>0){for(var t=[],a=e.features.length-1;a>=0;a--){var r=e.features[a].properties.name;t.push(r)}selectSidebarLayer(t);var o=JSON.stringify(e.features[0],void 0,1);copyArea.val(""),copyArea.val(o),checkActiveLayers(e.features)}},checkActiveLayers=function(e){$("#map-layers").find(".list-item").removeClass("active");for(var t=0;t<e.length;t++){var a=e[t].id;$("#map-layers").find(".list-item[layerId="+a+"]").addClass("active")}};map.on("draw.selectionchange",updateGeo),map.on("draw.update",(function(e,t){console.log(e,t),console.log("draw update"),updateLayerList()})),map.on("draw.create",(function(e,t){console.log(),addLayerToList(e.features[0])})),numUntitled=0;var addNewSidebarLayer=function(e,t){numUntitled+=1;var a=e.features[0];a.properties.name="Untitled Layer "+numUntitled,draw.delete(a.id);var r=draw.add(a);layersContainer.append('<article name="Untitled Layer '+numUntitled+'" layer-id="'+r+'" class="layer-item"><h2>Untitled Layer '+numUntitled+"</h2></article>")},bikeZone={coordinates:[[[-122.45421669942822,37.771176607233386],[-122.45299490469219,37.76650206575235],[-122.4444423415523,37.76746790432773],[-122.44331829039713,37.768974587309074],[-122.44019049588367,37.77051987131894],[-122.43813788072276,37.76912911716515],[-122.4376980346212,37.767004303376524],[-122.42909659969092,37.767854236233646],[-122.42841239464948,37.76453171594471],[-122.42631090769818,37.76460898555504],[-122.42456484192377,37.74334412878741],[-122.4244208923447,37.740782916839066],[-122.41859093415297,37.73890463842059],[-122.4153520684929,37.73896155664997],[-122.4153520684929,37.74135208270698],[-122.41779921143646,37.741807412247425],[-122.41923870728138,37.742945723865915],[-122.41743933747523,37.74596216495864],[-122.41463232056145,37.74658820336545],[-122.41002593385052,37.74675894019754],[-122.40757879089799,37.748580108521594],[-122.40318832856018,37.74960449600442],[-122.3975742947506,37.74966140600593],[-122.39642269806387,37.74738497186439],[-122.38843349610477,37.74266114759888],[-122.39161650365659,37.733705801466314],[-122.38341674697804,37.72957893861167],[-122.380320335362,37.73923815782551],[-122.38599708998782,37.742684334768185],[-122.38473558896146,37.74522352035916],[-122.38751784998493,37.77672987403679],[-122.38969680630254,37.77663922895211],[-122.39038489777278,37.77740970862921],[-122.387632531899,37.778860001486024],[-122.38751784998493,37.78878467961728],[-122.39181985363956,37.79374521322168],[-122.40231324854983,37.8045740066253],[-122.40764595744052,37.80797183627895],[-122.4141254854435,37.808968503325715],[-122.42077703631762,37.8081983527032],[-122.42049033153955,37.80498175442652],[-122.44784196745614,37.80181032319399],[-122.4468098302508,37.792974903851956],[-122.44508960157523,37.782733557331326],[-122.45632842891277,37.78150993871736],[-122.45421669942822,37.771176607233386]]],type:"Polygon"};bikeZone=turf.feature(bikeZone,{name:"bike zone perimeter"}),bikeZone=turf.featureCollection([bikeZone]);var kickZone={coordinates:[[[-122.472023,37.780816],[-122.481422,37.780384],[-122.481391,37.780068],[-122.472688,37.780503],[-122.472687,37.780498],[-122.471863,37.780528],[-122.459106,37.781043],[-122.458591,37.774429],[-122.460136,37.774225],[-122.4602,37.775684],[-122.471551,37.775141],[-122.471692,37.776913],[-122.472548,37.776916],[-122.48375,37.776388],[-122.483847,37.777846],[-122.484415,37.777829],[-122.484458,37.778525],[-122.483868,37.77855],[-122.483957,37.779942],[-122.483981,37.780266],[-122.483986,37.780266],[-122.484127,37.782004],[-122.472157,37.78253],[-122.472345,37.784935],[-122.466745,37.785156],[-122.459288,37.786199],[-122.459253,37.785761],[-122.459143,37.785774],[-122.459267,37.78742],[-122.445979,37.789116],[-122.446789,37.793032],[-122.441477,37.793682],[-122.442111,37.796805],[-122.447175,37.796161],[-122.44753,37.798356],[-122.437955,37.799518],[-122.438126,37.799646],[-122.444751,37.798831],[-122.447733,37.800798],[-122.448356,37.80502],[-122.441972,37.805825],[-122.439392,37.80449],[-122.437141,37.804716],[-122.437144,37.804731],[-122.434011,37.80513],[-122.431983,37.804231],[-122.431855,37.803553],[-122.425564,37.804356],[-122.425804,37.805664],[-122.423379,37.805977],[-122.421619,37.803646],[-122.421158,37.80307],[-122.419935,37.803214],[-122.419302,37.800044],[-122.412814,37.800895],[-122.411513,37.802892],[-122.413197,37.802697],[-122.413755,37.805511],[-122.409249,37.806062],[-122.408294,37.805579],[-122.408037,37.803935],[-122.407382,37.800806],[-122.405945,37.80101],[-122.404743,37.799984],[-122.402958,37.800304],[-122.403745,37.80368],[-122.405301,37.803502],[-122.405644,37.805426],[-122.406857,37.805308],[-122.406985,37.805833],[-122.405194,37.806054],[-122.404968,37.805003],[-122.403477,37.805104],[-122.403177,37.804833],[-122.402865,37.803434],[-122.401868,37.803536],[-122.401417,37.801552],[-122.400505,37.801663],[-122.400323,37.800739],[-122.399969,37.800798],[-122.399861,37.800035],[-122.398831,37.800086],[-122.398166,37.799086],[-122.39867,37.798916],[-122.400811,37.798655],[-122.400484,37.797034],[-122.39866,37.797254],[-122.398155,37.797314],[-122.396965,37.797483],[-122.396782,37.796627],[-122.395795,37.79678],[-122.395452,37.796364],[-122.396686,37.796178],[-122.396525,37.795406],[-122.40308,37.794516],[-122.403311,37.795584],[-122.403498,37.795724],[-122.403632,37.796292],[-122.404249,37.796233],[-122.404507,37.796441],[-122.403799,37.796551],[-122.404121,37.798128],[-122.403638,37.798195],[-122.403295,37.796644],[-122.40205,37.796805],[-122.401793,37.796847],[-122.400999,37.796949],[-122.401398,37.798584],[-122.402576,37.798441],[-122.402707,37.79909],[-122.407157,37.79856],[-122.407264,37.799103],[-122.405998,37.799272],[-122.406256,37.800628],[-122.410862,37.800075],[-122.410354,37.797441],[-122.416655,37.796655],[-122.416382,37.795242],[-122.408423,37.796288],[-122.407768,37.793117],[-122.407414,37.79316],[-122.407028,37.791421],[-122.40779,37.791303],[-122.40794,37.792006],[-122.415364,37.791065],[-122.415204,37.790353],[-122.415955,37.790243],[-122.416105,37.790947],[-122.418529,37.790675],[-122.418422,37.78998],[-122.42192,37.789471],[-122.422928,37.794508],[-122.420107,37.794859],[-122.4204,37.796188],[-122.423272,37.79583],[-122.424774,37.803146],[-122.425008,37.803146],[-122.424595,37.801312],[-122.432456,37.800344],[-122.432458,37.800209],[-122.426962,37.8009],[-122.425889,37.796017],[-122.434966,37.794931],[-122.434714,37.7937],[-122.432734,37.793956],[-122.432354,37.79229],[-122.424741,37.793278],[-122.424083,37.789757],[-122.424066,37.78976],[-122.423497,37.78703],[-122.433294,37.78581],[-122.433024,37.784545],[-122.438792,37.78378],[-122.438855,37.783702],[-122.444537,37.78288],[-122.444536,37.782875],[-122.445877,37.782688],[-122.447605,37.782612],[-122.448113,37.782542],[-122.447755,37.780992],[-122.453409,37.780263],[-122.452894,37.777778],[-122.446938,37.778616],[-122.446939,37.778621],[-122.440717,37.779398],[-122.441318,37.782451],[-122.439606,37.782678],[-122.439607,37.782688],[-122.427586,37.784293],[-122.426705,37.779975],[-122.427037,37.779935],[-122.426535,37.777478],[-122.424867,37.777689],[-122.424849,37.777558],[-122.423164,37.77777],[-122.42118,37.776659],[-122.421006,37.775351],[-122.420997,37.775353],[-122.42075,37.774166],[-122.424028,37.771567],[-122.423801,37.77141],[-122.4231,37.771427],[-122.422049,37.770562],[-122.420547,37.768492],[-122.416001,37.768715],[-122.416019,37.769773],[-122.41574,37.770833],[-122.418133,37.771935],[-122.418476,37.772928],[-122.410612,37.779195],[-122.409968,37.778677],[-122.399034,37.786783],[-122.395391,37.784346],[-122.40853,37.77353],[-122.406899,37.772207],[-122.410225,37.769527],[-122.413341,37.769671],[-122.413332,37.768847],[-122.413315,37.768848],[-122.412987,37.76554],[-122.403103,37.766097],[-122.403187,37.767059],[-122.404807,37.766949],[-122.404915,37.76767],[-122.403327,37.767763],[-122.403541,37.770121],[-122.402737,37.770188],[-122.401355,37.77124],[-122.401873,37.771684],[-122.401878,37.771681],[-122.403509,37.772936],[-122.404003,37.772538],[-122.405312,37.773538],[-122.406116,37.772894],[-122.406417,37.773191],[-122.404958,37.774344],[-122.404797,37.774157],[-122.395935,37.781153],[-122.394573,37.780176],[-122.393454,37.781096],[-122.39383,37.781406],[-122.394194,37.78111],[-122.394343,37.781006],[-122.394441,37.780973],[-122.394556,37.780969],[-122.394687,37.781024],[-122.394769,37.781111],[-122.394766,37.78121],[-122.394747,37.781263],[-122.394711,37.781311],[-122.394233,37.781695],[-122.394706,37.78208],[-122.395666,37.781289],[-122.39646,37.781917],[-122.394214,37.783712],[-122.393315,37.782973],[-122.394601,37.782163],[-122.394118,37.781784],[-122.393617,37.782171],[-122.393568,37.782197],[-122.393513,37.782216],[-122.393459,37.782227],[-122.393351,37.78223],[-122.393231,37.782196],[-122.393187,37.78213],[-122.393171,37.782078],[-122.39318,37.782017],[-122.393199,37.781945],[-122.393228,37.781882],[-122.393743,37.781485],[-122.393244,37.78109],[-122.390175,37.783567],[-122.391657,37.784762],[-122.390109,37.786048],[-122.391579,37.787199],[-122.393113,37.788373],[-122.391182,37.789878],[-122.392555,37.790938],[-122.392877,37.790684],[-122.392555,37.790421],[-122.392845,37.790175],[-122.393553,37.790769],[-122.392705,37.791455],[-122.392319,37.791167],[-122.391868,37.791574],[-122.392169,37.791811],[-122.391375,37.792507],[-122.391117,37.791642],[-122.391171,37.791498],[-122.388671,37.789421],[-122.388403,37.7887],[-122.389004,37.788208],[-122.389401,37.78853],[-122.389894,37.788157],[-122.38866,37.78708],[-122.389637,37.786364],[-122.389519,37.786063],[-122.390913,37.784774],[-122.389706,37.783905],[-122.390015,37.783672],[-122.389647,37.783375],[-122.390763,37.782493],[-122.389487,37.781399],[-122.390334,37.780789],[-122.38954,37.78017],[-122.389937,37.779856],[-122.390929,37.780584],[-122.391953,37.7798],[-122.3918,37.779676],[-122.394986,37.777133],[-122.396587,37.778364],[-122.403241,37.77314],[-122.401664,37.771859],[-122.401706,37.771823],[-122.400827,37.771096],[-122.399132,37.769739],[-122.39905,37.769673],[-122.397443,37.77046],[-122.395066,37.771138],[-122.393703,37.772724],[-122.391471,37.77409],[-122.391064,37.769951],[-122.395098,37.769747],[-122.395876,37.770201],[-122.398431,37.769175],[-122.397941,37.768781],[-122.399926,37.767305],[-122.399529,37.766881],[-122.400276,37.766272],[-122.396248,37.766523],[-122.396112,37.765606],[-122.395409,37.76566],[-122.394787,37.762326],[-122.408628,37.761504],[-122.407736,37.752796],[-122.406953,37.752843],[-122.406814,37.751172],[-122.406685,37.749942],[-122.407575,37.749908],[-122.407457,37.748635],[-122.407929,37.748491],[-122.409616,37.74845],[-122.409596,37.748284],[-122.409464,37.748288],[-122.409431,37.747499],[-122.410601,37.746828],[-122.415086,37.746616],[-122.416212,37.746981],[-122.417725,37.746387],[-122.417842,37.74593],[-122.417607,37.745745],[-122.417613,37.745746],[-122.417607,37.745743],[-122.420096,37.741976],[-122.418465,37.741297],[-122.416986,37.7409],[-122.415311,37.740835],[-122.41551,37.738912],[-122.418599,37.739095],[-122.422896,37.740809],[-122.419168,37.746539],[-122.419112,37.746618],[-122.418928,37.746926],[-122.418326,37.746998],[-122.415139,37.748135],[-122.411037,37.748245],[-122.411116,37.749178],[-122.42269,37.748664],[-122.422596,37.747974],[-122.429881,37.747609],[-122.430031,37.749577],[-122.434451,37.749306],[-122.434816,37.754065],[-122.42798,37.754455],[-122.428468,37.759525],[-122.430438,37.759417],[-122.432477,37.759281],[-122.43237,37.757627],[-122.438228,37.757279],[-122.438668,37.761554],[-122.43767,37.761758],[-122.436211,37.762114],[-122.435202,37.762521],[-122.431018,37.765727],[-122.431017,37.765726],[-122.428271,37.767797],[-122.426598,37.769239],[-122.424743,37.769284],[-122.424862,37.770518],[-122.425353,37.770502],[-122.425675,37.771656],[-122.42672,37.771525],[-122.426576,37.770731],[-122.427842,37.769646],[-122.429366,37.769561],[-122.429151,37.767559],[-122.435224,37.762742],[-122.436652,37.770256],[-122.43679,37.770239],[-122.439286,37.769924],[-122.440298,37.770604],[-122.443619,37.770158],[-122.443431,37.76923],[-122.444751,37.769044],[-122.444311,37.766584],[-122.443946,37.765702],[-122.44504,37.765057],[-122.447584,37.764753],[-122.447583,37.764744],[-122.45239,37.76417],[-122.45239,37.764167],[-122.455297,37.763887],[-122.45667,37.763539],[-122.456794,37.764939],[-122.45769,37.764828],[-122.457915,37.764442],[-122.459664,37.764353],[-122.459621,37.763878],[-122.461102,37.763844],[-122.461016,37.762165],[-122.461863,37.761995],[-122.46299,37.761902],[-122.483511,37.760982],[-122.483822,37.765271],[-122.459567,37.766406],[-122.458716,37.766438],[-122.458006,37.766327],[-122.458051,37.766593],[-122.458365,37.767125],[-122.458092,37.767221],[-122.457757,37.766657],[-122.457665,37.766273],[-122.456874,37.766202],[-122.452984,37.766703],[-122.453505,37.769077],[-122.448699,37.76973],[-122.444387,37.770285],[-122.444504,37.770867],[-122.445398,37.770768],[-122.445298,37.770273],[-122.453666,37.769213],[-122.454036,37.771065],[-122.440963,37.772792],[-122.44077,37.771868],[-122.44032,37.771927],[-122.440502,37.772817],[-122.437412,37.773215],[-122.437434,37.773318],[-122.437323,37.773331],[-122.437791,37.774047],[-122.441001,37.773657],[-122.440958,37.773466],[-122.44572,37.772867],[-122.445725,37.772894],[-122.453012,37.77202],[-122.453639,37.77496],[-122.454686,37.774836],[-122.45814,37.774853],[-122.458722,37.781407],[-122.458915,37.7814],[-122.458913,37.781374],[-122.472023,37.780814],[-122.472023,37.780816]]],type:"Polygon"};kickZone=turf.feature(kickZone,{name:"kick zone perimeter"}),kickZone=turf.featureCollection([kickZone]),draw.add(kickZone);var layersContainer=$(".layers-container"),addStartingFeatures=function(){map.on("load",(function(){}))};addStartingFeatures();var expandFeaturePerimeter=function(){var e,t=prompt("Enter number of METERS to expand this zone","500");null!=t&&(e=t);var a=draw.getSelected();a=a.features[0];var r=turf.buffer(a,e,{units:"meters"}),o=turf.featureCollection([r]),n=draw.add(o);addLayerToList(o,n)},combineSelectedFeatures=function(){var e=draw.getSelected();if(console.log(e),2===e.features.length){var t=e.features[0],a=e.features[1],r=turf.intersect(t,a);if(console.log(r),null===r)return;var o=turf.union(t,a),n=turf.featureCollection([o]);removeLayerFromList(t),removeLayerFromList(a),draw.delete(t.id),draw.delete(a.id);var l=draw.add(n);addLayerToList(n,l)}},createIsland=function(){var e=draw.getSelected();if(console.log(e),2===e.features.length){var t=e.features[0],a=e.features[1],r=turf.intersect(t,a);if(console.log(r),null!==r){var o,n;turf.area(t)<turf.area(a)?(console.log("switch"),o=a,n=t):(o=t,n=a);var l=turf.difference(o,n),i=turf.featureCollection([l]);draw.delete(t.id),draw.delete(a.id),draw.add(i)}}},subtractFromPerimeter=function(){var e=draw.getSelected();if(1===e.features.length){var t=e.features[0],a=turf.difference(t,zone),r=e.features[0].id;turf.featureCollection([a]);draw.delete(r),draw.add(a)}},snapToNearestPoint=function(){console.log("snapper!");var e=draw.getAll(),t=draw.getSelectedPoints(),a=draw.getSelected();if(1===t.features.length){var r=a.features[0].id,o=[];turf.featureEach(e,(function(e){e.id!==r&&o.push(e)}));o=turf.featureCollection(o);var n=turf.explode(o),l=turf.nearestPoint(t.features[0],n),i=[];turf.coordEach(a,(function(e){e[1]===t.features[0].geometry.coordinates[1]?i.push(l.geometry.coordinates):i.push(e)}));var s=turf.featureCollection([turf.polygon([i])]);draw.delete(r);var d=draw.add(s);addLayerToList(s,d,r),removeLayerFromList(r,!0),draw.changeMode("simple_select",{featureIds:d})}},getLatestData=function(e){},hidePresentationLayer=function(e,t){var a=JSON.parse(map.queryRenderedFeatures({layers:[e]})[0].properties.defaultOpacity);map.setPaintProperty(e,a[0],0),t.parent().find('i[type="lock"]').removeClass("ion-md-unlock").addClass("ion-md-lock")},showPresentationLayer=function(e,t){var a=JSON.parse(map.queryRenderedFeatures({layers:[e]})[0].properties.defaultOpacity);map.setPaintProperty(e,a[0],a[1])},unlockDrawLayer=function(e,t){getLatestData(e);var a=JSON.parse(map.queryRenderedFeatures({layers:[e]})[0].properties.defaultOpacity);map.setPaintProperty(e,a[0],0),draw.add(zone)},lockDrawLayer=function(e,t){JSON.parse(map.queryRenderedFeatures({layers:[e]})[0].properties.defaultOpacity)},toggleLayer=function(e,t,a,r,o){console.log(t,a),"viz"===t?"show"===a?showPresentationLayer(r,o):hidePresentationLayer(r,o):"lock"===t&&("unlock"===a?unlockDrawLayer(r,o):lockDrawLayer(r,o))},toggleScooterExclusions=function(e,t){},toggleNeighborhoods=function(e,t){},updateLayerProps=function(e,t,a,r){console.log(e,t,a),"perimeter"===e?togglePerimeter(t,a):"scooter-exclusion"===e?toggleScooterExclusions(t,a):"service-area"===e&&toggleNeighborhoods(t,a)};$(".controls").on("click","i.icon",(function(){var e,t,a=$(this).hasClass("ion-md-eye"),r=$(this).hasClass("ion-md-eye-off"),o=$(this).hasClass("ion-md-unlock"),n=$(this).hasClass("ion-md-lock"),l=$(this).attr("layer"),i=$(this).attr("type");"perimeter"===l&&(t="zone-perimeter-layer"),"scooter-exclusion"===l&&(t="scooter-exclusion-layer"),"service-area"===l&&(t="neighborhoods-layer"),n?($(this).removeClass("ion-md-lock").addClass("ion-md-unlock"),e="unlock"):o?($(this).removeClass("ion-md-unlock").addClass("ion-md-lock"),e="lock"):a?($(this).removeClass("ion-md-eye").addClass("ion-md-eye-off"),e="hide"):r&&($(this).removeClass("ion-md-eye-off").addClass("ion-md-eye"),e="show"),toggleLayer(l,i,e,t,$(this))}));var deleteLayers=function(){var e=draw.getSelected();if(selectedPolys=e.features,console.log(selectedPolys),0!==selectedPolys.length)for(var t=selectedPolys.length-1;t>=0;t--){var a=selectedPolys[t].id;removeLayerFromList(selectedPolys[t]);var r=selectedPolys[t].properties.name;$(".layers-container").find("article[name='"+r+"']").remove(),draw.delete(a)}else console.log("none!")},newPolygonLayer=function(){console.log("start drawing"),draw.changeMode("draw_polygon")},newLineLayer=function(){console.log("start drawing"),draw.changeMode("draw_line_string")},newPointLayer=function(){console.log("start drawing"),draw.changeMode("draw_point")},cutFeature=function(){var e=draw.getSelected(),t=e.features[0],a=e.features[1],r=turf.intersect(t,a);if(console.log(r),null!==r){var o,n;turf.area(t)<turf.area(a)?(console.log("switch"),o=a,n=t):(o=t,n=a);var l=turf.difference(o,n),i=turf.intersect(n,o),s=turf.featureCollection([l]),d=turf.featureCollection([i]);draw.delete(t.id),draw.delete(a.id),removeLayerFromList(t.id,!0),removeLayerFromList(a.id,!0);var c=draw.add(s),p=draw.add(d);addLayerToList(s,c),addLayerToList(d,p)}},duplicateFeature=function(){var e="new"+Math.random(),t=draw.getSelected().features[0];delete t.id,console.log(e.toString());var a=turf.featureCollection([t]),r=draw.add(a);console.log(r),addLayerToList(a,r)},createCenteroid=function(){var e=draw.getSelected().features[0],t=turf.centerOfMass(e),a=turf.featureCollection([t]),r=draw.add(a);console.log(r),addLayerToList(a,r)},combineGeometry=function(){console.log("combine"),draw.combineFeatures()},seperateGeometry=function(){console.log("uncombine"),draw.uncombineFeatures()},createRandomPoints=function(){var e,t=prompt("Enter number of random Points","asd");if(null!=t&&NaN!==(e=parseInt(t))){var a=draw.getSelected().features[0],r=turf.bbox(a);console.log(r);var o=turf.randomPoint(e,{bbox:r}),n=(o=turf.randomPoint(4*e,{bbox:r}),turf.pointsWithinPolygon(o,a));console.log(n),console.log(n.features.length);var l=n.features.slice(0,e);console.log(l);var i=turf.featureCollection(l);console.log(i);var s=draw.add(i);console.log(s),draw.changeMode("simple_select",{featureIds:s}),combineGeometry()}};$(".action-btn-list li, *[map-action]").on("click",(function(){var e=$(this).attr("action");console.log(e),"delete"===e&&deleteLayers(),"new-polygon-layer"===e&&newPolygonLayer(),"new-line-layer"===e&&newLineLayer(),"centeroid"===e&&createCenteroid(),"rand-points"===e&&createRandomPoints(),"combine-geometry"===e&&combineGeometry(),"seperate-geometry"===e&&seperateGeometry(),"new-point-layer"===e&&newPointLayer(),"duplicate"===e&&duplicateFeature(),"combine"===e&&combineSelectedFeatures(),"hole"===e&&createIsland(),"expand"===e&&expandFeaturePerimeter(),"snap"===e&&snapToNearestPoint(),"cut"===e&&cutFeature()})),document.addEventListener("keydown",(function(e){e=e||window.event,console.log(e.keyCode),8===e.keyCode&&deleteLayers(),49===e.keyCode&&newPointLayer(),50===e.keyCode&&newLineLayer(),51===e.keyCode&&newPolygonLayer(),52===e.keyCode&&snapToNearestPoint(),68===e.keyCode&&duplicateFeature()})),$(".layers-container").on("click","article",(function(){var e=$(this).attr("layer-id");console.log(e),draw.changeMode("simple_select",{featureId:e});var t=draw.get(e);console.log(t);var a=turf.centerOfMass(t.geometry);a=a.geometry.coordinates,map.easeTo({center:a})})),$(".context-list").on("click",'li:not(".active")',(function(){$(".context-list li").removeClass("active"),$(this).addClass("active");var e,t=$(this).attr("context");if(console.log(t),"bike"===t)e=bikeZone;else if("genze"===t)e=zones;else{if("kick"!==t)return;e=kickZone}draw.deleteAll(),$(".layers-container").find("article").remove(),addZones(e)}));var panMap=function(e){var t;"sfo"===e?(t=[-122.42271869842615,37.77645740426891],map.setBearing(0)):"scl"===e?(t=[-70.596168,-33.4225424],map.setBearing(0)):(t=[2.1734,41.3851],map.setBearing(-44.7)),map.setZoom(13),map.setCenter(t)};$("#region-picker input").on("change",(function(){var e=$(this).val();console.log(e),panMap(e)})),$("#map-tools input").on("change",(function(){var e,t=$(this).val();e="dark"===t?darkStyle:"light"===t?lightStyle:"satellite-labels"===t?satelliteStreetStyle:"street"===t?streetStyle:satelliteStyle,map.setStyle(e)})),$(".paster textarea").on("change",(function(){var e=$(".paster textarea").val();console.log(e)})),$("#submit-paster").click((function(){var e=$(".paster textarea").val(),t=JSON.parse(e);draw.add(t);var a=turf.bbox(t);console.log(a),map.fitBounds(a,{linear:!0,padding:50});e=$(".paster textarea").val("")}));var dragged,processGeoDropFile=function(e,t,a){if(a){var r=(new DOMParser).parseFromString(e,"text/xml"),o=toGeoJSON.kml(r);console.log("KML"),draw.add(o);for(var n=0;n<o.features.length;n++)addLayerToList(o.features[n]);var l=turf.bbox(o);map.fitBounds(l,{linear:!0,padding:50})}else{o=t?e:JSON.parse(e),console.log(o),draw.add(o);for(n=0;n<o.features.length;n++)addLayerToList(o.features[n]);l=turf.bbox(o);map.fitBounds(l,{linear:!0,padding:50})}},copyShit=function(){console.log("asdasdasdasd");var e=$("#log").find("pre");console.log(e),e.select(),console.log(e)},cc=$("#copier");cc.click(copyShit);var theDropZone=$(".drop_zone");function previewFile(e){var t=new FileReader;t.readAsText(e);var a=e.name.split(".")[1];console.log(a),"geojson"!==a&&"kml"!==a||(t.onloadend=function(){"kml"===a?processGeoDropFile(t.result,!1,!0):processGeoDropFile(t.result)})}function dropHandler(e){if(theDropZone.removeClass("active"),console.log("File(s) dropped"),e.preventDefault(),console.log(e),e.dataTransfer.items)for(var t=0;t<e.dataTransfer.items.length;t++){if("file"===e.dataTransfer.items[t].kind)previewFile(e.dataTransfer.items[t].getAsFile())}else for(t=0;t<e.dataTransfer.files.length;t++)console.log(e.dataTransfer.files[t])}document.addEventListener("drag",(function(e){}),!1),document.addEventListener("dragstart",(function(e){dragged=e.target,e.target.style.opacity=.5}),!1),document.addEventListener("dragend",(function(e){e.target.style.opacity=""}),!1),document.addEventListener("dragover",(function(e){e.preventDefault()}),!1),document.addEventListener("dragenter",(function(e){"dropzone"==e.target.className&&(e.target.style.background="purple")}),!1),document.addEventListener("dragleave",(function(e){theDropZone.removeClass("active"),"dropzone"==e.target.className&&(e.target.style.background="")}),!1),document.addEventListener("drop",(function(e){e.preventDefault(),"dropzone"==e.target.className&&(e.target.style.background="",dragged.parentNode.removeChild(dragged),e.target.appendChild(dragged))}),!1);var dragOverHandler=function(e){theDropZone.addClass("active")},linkEl=$("#save-file");linkEl.click((function(){var e="Untitled",t=prompt("Please enter a filename","e.g. scoot-kick-layers");if(null!=t){e=t;var a=draw.getAll();a=JSON.stringify(a),console.log(a);var r=new Blob([a],{type:"text/plain;charset=utf-8"});saveAs(r,e+".geojson")}}));var updateSearchResults=function(e){var t=e;$.getJSON("https://api.mapbox.com/geocoding/v5/mapbox.places/"+t+".json?bbox=-122.540817,37.725422,-122.344780,37.818506&types=address&access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4M29iazA2Z2gycXA4N2pmbDZmangifQ.-g_vE53SD2WrJ6tFX7QHmA&limit=5",(function(e,t,a){a&&a.status&&generateSearchItems(e.features)}))}
;$(".dataset-list li").click((function(){var e=$(this).attr("dataset");getDatasetFromMapbox("sfo-kick"===e?"cjj8smoub015kton00psuk61m":"sfo-moto"===e?"cjkbsjots02uzkimrr4r94yky":"scl-all"===e?"cjmnr3kid06ep32o6wp3pj6nj":"cjg890y8o024tvmp6x0cxck8r")}));var getDatasetFromMapbox=function(e){var t="https://api.mapbox.com/datasets/v1/scoottech/"+e+"/features?access_token=pk.eyJ1Ijoic2Nvb3R0ZWNoIiwiYSI6IlBMTjNqVTgifQ.r8a_cZRmGF_GIOKIKaK1dA";$.getJSON(t,(function(e,t,a){a&&a.status&&(console.log(e),processGeoDropFile(e,!0))}))};$("#map-layers").on("click",".fa-search-plus",(function(){var e=$(this).parent().parent().parent().attr("layerid"),t=$(this).parent().parent().parent().attr("type"),a=draw.get(e);if(console.log(t),"Point"===t){var r=a.geometry.coordinates;map.easeTo({center:r,zoom:14})}else{var o=turf.bbox(a);map.fitBounds(o,{linear:!0,padding:150})}})),$("#map-layers").on("click",".fa-trash",(function(){var e=$(this).parent().parent().parent().attr("layerid");draw.delete(e),removeLayerFromList(e,!0)})),$("#map-layers").on("click",".fa-pencil-alt",(function(){var e=$(this).parent().parent().parent().find("p").text(),t=prompt("Enter a name for this layer",e);null!=t&&(name=t),$(this).parent().parent().parent().find("p").text(name);var a=$(this).parent().parent().parent().attr("layerid");console.log(a);var r=draw.get(a);draw.delete(a),console.log(r),r.properties.layerName=name,draw.add(r)})),$("#map-layers").on("click",".list-item",(function(){var e=$(this).attr("layerid");if("Point"===$(this).attr("type")){var t=draw.get(e).geometry.coordinates;map.easeTo({center:t,zoom:14})}else draw.changeMode("direct_select",{featureId:e})})),$("#hints").on("change",(function(){var e=$(this).prop("checked");console.log(e),e?$(".right-sidebar .list-item div:nth-child(2)").slideDown(250):$(".right-sidebar .list-item div:nth-child(2)").slideUp(250)}));